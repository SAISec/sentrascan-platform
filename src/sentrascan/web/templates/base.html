<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}SentraScan Platform{% endblock %}</title>
  
  <!-- Design System CSS -->
  <link rel="stylesheet" href="/static/css/main.css" />
  <link rel="stylesheet" href="/static/css/components.css" />
  <link rel="stylesheet" href="/static/css/responsive.css" />
  <link rel="stylesheet" href="/static/css/loading.css" />
  <link rel="stylesheet" href="/static/css/print.css" media="print" />
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  {% block extra_head %}{% endblock %}
</head>
<body>
  <!-- Skip link for keyboard navigation -->
  <a href="#main-content" class="skip-link" aria-label="Skip to main content">Skip to main content</a>
  
  <!-- ARIA Live Regions for screen reader announcements -->
  <div id="aria-live-polite" role="status" aria-live="polite" aria-atomic="true" class="sr-only"></div>
  <div id="aria-live-assertive" role="alert" aria-live="assertive" aria-atomic="true" class="sr-only"></div>

  <!-- Header -->
  <header role="banner" style="background-color: var(--color-bg-primary); border-bottom: 1px solid var(--color-border-light); position: sticky; top: 0; z-index: var(--z-index-sticky);">
    <div class="container" style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-md) var(--spacing-lg); max-width: 1400px; margin: 0 auto;">
      <!-- Logo/Brand -->
      <div style="display: flex; align-items: center; gap: var(--spacing-md);">
        <h1 style="margin: 0; font-size: var(--font-size-xl); font-weight: var(--font-weight-bold);">
          <a href="/" style="color: var(--color-text-primary); text-decoration: none; display: flex; align-items: center; gap: var(--spacing-sm);">
            <span>SentraScan</span>
            <span style="color: var(--color-primary);">Platform</span>
          </a>
        </h1>
      </div>
      
      <!-- Desktop Navigation -->
      <nav class="nav-desktop" role="navigation" aria-label="Main navigation">
        <ul style="display: flex; list-style: none; margin: 0; padding: 0; gap: var(--spacing-sm); align-items: center;">
          <li>
            {% set current_path = request.url.path if request else '' %}
            {% set is_dashboard_active = 'nav-link-active' if (current_path == '/' or current_path == '') else '' %}
            <a href="/" class="nav-link {{ is_dashboard_active }}" 
               style="display: block; padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-md); transition: background-color var(--transition-fast);">
              Dashboard
            </a>
          </li>
          <li>
            {% set is_baselines_active = 'nav-link-active' if current_path and current_path.startswith('/baselines') else '' %}
            <a href="/baselines" class="nav-link {{ is_baselines_active }}" 
               style="display: block; padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-md); transition: background-color var(--transition-fast);">
              Baselines
            </a>
          </li>
          <li>
            {% set is_scan_active = 'nav-link-active' if current_path and current_path.startswith('/ui/scan') else '' %}
            <a href="/ui/scan" class="nav-link {{ is_scan_active }}" 
               style="display: block; padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-md); transition: background-color var(--transition-fast);">
              Run Scan
            </a>
          </li>
        </ul>
      </nav>

      <!-- User Menu (Desktop) -->
      <div class="user-menu-desktop" style="display: flex; align-items: center; gap: var(--spacing-md);">
        {% block user_menu %}
        {% if request and request.cookies.get('ss_session') %}
          <div class="user-menu" style="position: relative;">
            <button class="user-menu-toggle" 
                    data-dropdown="user-menu-dropdown"
                    aria-label="User menu" 
                    aria-expanded="false" 
                    style="display: flex; align-items: center; gap: var(--spacing-xs); padding: var(--spacing-xs) var(--spacing-sm); background: none; border: 1px solid var(--color-border-light); border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition-fast);">
              <span style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                {% if user.name %}{{ user.name }}{% else %}User{% endif %}
              </span>
              <span class="icon icon-chevron-down icon-sm" aria-hidden="true"></span>
            </button>
            <div id="user-menu-dropdown" class="user-menu-dropdown" 
                 role="menu"
                 aria-hidden="true"
                 style="display: none; position: absolute; top: 100%; right: 0; margin-top: var(--spacing-xs); background: var(--color-bg-primary); border: 1px solid var(--color-border-light); border-radius: var(--radius-md); box-shadow: var(--shadow-lg); min-width: 180px; z-index: var(--z-index-dropdown);">
              <ul style="list-style: none; margin: 0; padding: var(--spacing-xs);">
                <li>
                  <a href="/logout" 
                     role="menuitem"
                     style="display: block; padding: var(--spacing-sm) var(--spacing-md); border-radius: var(--radius-sm); transition: background-color var(--transition-fast);">
                    Logout
                  </a>
                </li>
              </ul>
            </div>
          </div>
        {% else %}
          <a href="/login" class="btn btn-primary btn-sm">Login</a>
        {% endif %}
        {% endblock %}
      </div>

      <!-- Global Search (Mobile) -->
      <div class="global-search-mobile" style="display: none; flex: 1; margin: 0 var(--spacing-sm);">
        <form id="global-search-form-mobile" method="get" action="/" style="display: flex; width: 100%;">
          <input 
            type="search" 
            id="global-search-input-mobile"
            name="search"
            class="form-input" 
            placeholder="Search..."
            aria-label="Global search"
            style="flex: 1; margin: 0; font-size: var(--font-size-sm);">
        </form>
      </div>

      <!-- Mobile Navigation Toggle -->
      <button class="nav-mobile-toggle" aria-label="Toggle navigation menu" aria-expanded="false" 
              style="display: none; background: none; border: none; cursor: pointer; padding: var(--spacing-sm); min-width: 44px; min-height: 44px; align-items: center; justify-content: center;">
        <span class="icon icon-menu icon-lg" aria-hidden="true" style="color: var(--color-text-primary);">☰</span>
      </button>
    </div>
  </header>

  <!-- Mobile Navigation Drawer -->
  <nav class="nav-mobile-drawer" role="navigation" aria-label="Mobile navigation" 
       style="display: none; position: fixed; top: 0; left: 0; width: 280px; height: 100vh; max-height: 100vh; background: var(--color-bg-primary); border-right: 1px solid var(--color-border-light); box-shadow: var(--shadow-xl); z-index: var(--z-index-modal); overflow-y: auto; transform: translateX(-100%); transition: transform var(--transition-base, 0.3s ease);">
    <div style="padding: var(--spacing-lg);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl); padding-bottom: var(--spacing-md); border-bottom: 1px solid var(--color-border-light);">
        <h2 style="margin: 0; font-size: var(--font-size-lg);">Menu</h2>
        <button class="nav-mobile-close" aria-label="Close navigation menu" 
                style="background: none; border: none; cursor: pointer; padding: var(--spacing-sm); min-width: 44px; min-height: 44px; display: flex; align-items: center; justify-content: center;">
          <span class="icon icon-close icon-lg" aria-hidden="true" style="color: var(--color-text-primary);">✕</span>
        </button>
      </div>
      <ul style="list-style: none; margin: 0; padding: 0;">
        <li style="margin-bottom: var(--spacing-xs);">
          {% set current_path = request.url.path if request else '' %}
          {% set is_dashboard_active = 'nav-link-active' if (current_path == '/' or current_path == '') else '' %}
          <a href="/" class="nav-link {{ is_dashboard_active }}" style="display: block; padding: var(--spacing-md); border-radius: var(--radius-md); transition: background-color var(--transition-fast);">
            Dashboard
          </a>
        </li>
        <li style="margin-bottom: var(--spacing-xs);">
          {% set is_baselines_active = 'nav-link-active' if current_path and current_path.startswith('/baselines') else '' %}
          <a href="/baselines" class="nav-link {{ is_baselines_active }}" style="display: block; padding: var(--spacing-md); border-radius: var(--radius-md); transition: background-color var(--transition-fast);">
            Baselines
          </a>
        </li>
        <li style="margin-bottom: var(--spacing-xs);">
          {% set is_scan_active = 'nav-link-active' if current_path and current_path.startswith('/ui/scan') else '' %}
          <a href="/ui/scan" class="nav-link {{ is_scan_active }}" style="display: block; padding: var(--spacing-md); border-radius: var(--radius-md); transition: background-color var(--transition-fast);">
            Run Scan
          </a>
        </li>
      </ul>
      <div style="margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 1px solid var(--color-border-light);">
        {% block user_menu_mobile %}
        {% if request and request.cookies.get('ss_session') %}
          <a href="/logout" class="btn btn-secondary" style="width: 100%;">Logout</a>
        {% else %}
          <a href="/login" class="btn btn-primary" style="width: 100%;">Login</a>
        {% endif %}
        {% endblock %}
      </div>
    </div>
  </nav>
  
  <!-- Mobile Navigation Overlay -->
  <div class="nav-mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: var(--z-index-modal-backdrop); opacity: 0; transition: opacity var(--transition-base);"></div>

  <!-- Toast Container (for progressive enhancement, also created by JS) -->
  <div id="toast-container" aria-live="polite" aria-atomic="false" 
       style="position: fixed; top: 20px; right: 20px; z-index: var(--z-index-tooltip, 10000); display: flex; flex-direction: column; gap: var(--spacing-sm, 8px); max-width: 400px; pointer-events: none; visibility: visible;"></div>

  <!-- Main Content -->
  <main id="main-content" role="main">
    <div class="container" style="padding: var(--spacing-lg);">
      {% block content %}{% endblock %}
    </div>
  </main>

  <!-- Footer -->
  <footer role="contentinfo" class="footer" style="margin-top: var(--spacing-2xl); padding: var(--spacing-xl) var(--spacing-lg); border-top: 1px solid var(--color-border-light); background-color: var(--color-bg-secondary);">
    <div class="container" style="max-width: 1400px; margin: 0 auto;">
      <!-- Severity Legend -->
      <div style="margin-bottom: var(--spacing-lg);">
        <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-sm);">
          <strong>Severity legend:</strong>
        </p>
        <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-sm); align-items: center;">
          <span class="badge badge-critical">Critical</span>
          <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">indicates immediate action required;</span>
          <span class="badge badge-high">High</span>
          <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">is severe and should be addressed promptly;</span>
          <span class="badge badge-medium">Medium</span>
          <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">requires attention;</span>
          <span class="badge badge-low">Low</span>
          <span style="font-size: var(--font-size-xs); color: var(--color-text-secondary);">is informational or minor.</span>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid var(--color-border-light);">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: var(--spacing-md);">
          <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0;">
            <strong>SentraScan Platform</strong>
          </p>
          {% block footer_version %}
          {% if app_version is defined %}
          <span style="font-size: var(--font-size-xs); color: var(--color-text-tertiary);">
            v{{ app_version }}
          </span>
          {% endif %}
          {% endblock %}
        </div>
        <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-md); align-items: center;">
          {% block footer_links %}
          <!-- Footer links can be added here if needed -->
          {% endblock %}
          <p style="font-size: var(--font-size-xs); color: var(--color-text-tertiary); margin: 0;">
            &copy; 2024 SentraScan
          </p>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript for mobile navigation and other interactions -->
    <script src="/static/js/navigation.js" defer></script>
    <script src="/static/js/modal.js" defer></script>
    <script src="/static/js/toast.js" defer></script>
    <script src="/static/js/dropdown.js" defer></script>
    <script src="/static/js/tabs.js" defer></script>
    <script src="/static/js/realtime.js" defer></script>
    <script src="/static/js/filtering.js" defer></script>
    <script src="/static/js/accessibility.js" defer></script>
  {% block extra_scripts %}{% endblock %}
</body>
</html>
